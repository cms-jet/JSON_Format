import pandas as pd
import numpy as np
from collections import OrderedDict
from correctionlib.schemav1 import Correction, Binning, Category, Formula
import helperfunctions

bprintouts=True

infile = 'DeepAK8V2_Top_W_SFs.csv'
print("Read in "+infile)

data = pd.read_csv(infile, names=['Object','Year','version','MistaggingRate','pT_low','pT_high','SF','SF_lowerErr','SF_upperErr'])

data = data.iloc[1: , :]
if bprintouts: 
    print("Head of the CSV file that is read in")
    print(data.head())

pt_lows = data.pT_low.values.tolist()


dataInfo = OrderedDict()
dataInfo['workingPoint'] = data.MistaggingRate.values.tolist()
dataInfo['year'] = data.Year.values.tolist()
dataInfo['valueType'] = data.version.values.tolist()
dataInfo['ptMin'] = data.pT_low.values.tolist()
dataInfo['ptMax'] = data.pT_high.values.tolist()
dataInfo['etaMin'] = ["-2.4" for el in data.pT_high.values.tolist()]
dataInfo['etaMax'] = ["2.4" for el in data.pT_high.values.tolist()]
dataInfo['scaleFactor'] = data.SF.values.tolist()
dataInfo['scaleFactorSystUncty_up'] = data.SF_lowerErr.values.tolist()
dataInfo['scaleFactorSystUncty_down'] = data.SF_upperErr.values.tolist()


df = pd.DataFrame( dataInfo )
if bprintouts: print(df)


corr_deepak8 = Correction.parse_obj(
    {
        "version": 1,
        "name": "DeepAK8",
        "description": "Scale factor for DeepAK8 algorithm (nominal and mass decorrelated)",
        "inputs": [
            {"name": "year", "type": "string", 'description': 'Data taking dataset'},
            {"name": "workingPoint", "type": "string", 'description': 'WP: Mistaggin rate of '},
            {"name": "valueType", "type": "string", "description": "Efficiency or misstag"},
            {"name": "eta", "type": "real"},
            {"name": "pt", "type": "real"},
            {"name": "scaleFactor", "type": "real", "description": "Scale Factor"},
        ],
        "output": {"name": "weight", "type": "real"},
        "data": build_year(df),
    }
)

print(corr_puID)
